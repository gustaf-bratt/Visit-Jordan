////  EventsViewController.m//  VistJOrdan New////  Created by Faris on 11/21/13.//  Copyright (c) 2013 Faris. All rights reserved.//#import "UIImage+StackBlur.h"#import "CustomCell.h"#import "HeaderView.h"#import <QuartzCore/QuartzCore.h>#import <UIKit/UIColor.h>#import "UIColor_Hex.h"#import "EventsViewController.h"#import "InternetConnection.h"#import "EventDetailsViewController.h"#import "HUD.h"#define IS_HEIGHT_GTE_568 [[UIScreen mainScreen ] bounds].size.height >= 568.0f#define SCREEN_HEIGHT [[UIScreen mainScreen ] bounds].size.height>=568.0f?480:300;@interface EventsViewController ()//@property NSDictionary * ListOfData;@property (nonatomic,strong) NSArray *arrayOfData;@property (nonatomic,retain) NSDictionary *ListOfData_2;@property NSInteger listsize;@end@implementation EventsViewControllerHeaderView *v;float alpha,sectionHeight;@synthesize ListOfData_2,arrayOfData,listsize;@synthesize BlurBackground,NormalBackground,BluredImage,cTable;@synthesize LabeltextDescription,LabelViewTitle,backgroundImageName;@synthesize ViewTitle,ViewName;@synthesize arr_tableData,arr_tableImages;@synthesize descriptionPlaceHolderSize;- (void)viewDidLoad{     [super viewDidLoad];    self.title =ViewName;    UIImage *image = [UIImage imageNamed: backgroundImageName];    [NormalBackground setImage:image];        BluredImage= [[UIImage imageNamed:backgroundImageName] stackBlur:100];        [BlurBackground setImage:BluredImage];    BlurBackground.alpha=0;            cTable.backgroundColor = [UIColor clearColor];    cTable.backgroundView = [UIView new] ;            [self.cTable registerNib:[UINib nibWithNibName:@"CustomCell" bundle:[NSBundle mainBundle]] forCellReuseIdentifier:@"Cell"];    self.cTable.rowHeight = 100;        if (IS_HEIGHT_GTE_568) {        v =[[[NSBundle mainBundle]loadNibNamed:@"HeaderView" owner:Nil options:nil]lastObject];            } else {        v =[[[NSBundle mainBundle]loadNibNamed:@"HeaderView-IponeS4" owner:Nil options:nil]lastObject];            }        v.parentViewName.text=ViewTitle;    v.ViewName.text=ViewName;    [v.ViewName setFont:[UIFont fontWithName:@"Ubuntu-Light" size:30]];    [v setFrame:CGRectMake(0, 0, 320, self.cTable.bounds.size.height)];    v.backgroundColor =[UIColor clearColor];    self.cTable.tableHeaderView =v;         if ([self connectedToInternet]) {            [HUD showUIBlockingIndicatorWithText:@"Loading... Please Wait" withTimeout:10];                dispatch_queue_t loadJSON = dispatch_queue_create("Load JSON Feed",NULL);                dispatch_async(loadJSON, ^{                        //NSLog(@"loading Started...");            NSString *url = [[NSString alloc]initWithFormat:@"http://calendar.jo/MobileEvent.ashx" ];                        NSData* ytData = [NSData dataWithContentsOfURL:                              [NSURL URLWithString:url]                              ];                        if (ytData!=Nil) {                               ListOfData_2 = [NSJSONSerialization                                   JSONObjectWithData:ytData                                   options:kNilOptions                                   error:nil];                            NSLog(@"%@",ListOfData_2);            }            dispatch_async(dispatch_get_main_queue(), ^{                                //NSLog(@"JSON:%@",json);                //NSLog(@"loading finished");                [HUD hideUIBlockingIndicator];                                if (ListOfData_2 !=nil)                {                    self.arrayOfData = [ListOfData_2 objectForKey:@"Events"];                    listsize =  arrayOfData.count;                                        [self.cTable reloadData];                }else{                                        UIAlertView *someError = [[UIAlertView alloc] initWithTitle: @"Network Error"                                                                        message: @"Error connecting to the internet"                                                                       delegate: self cancelButtonTitle: @"Ok" otherButtonTitles: nil];                    [someError show];                    self.ListOfData_2=nil;                }                            });                    });        }    }- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView{    // Return the number of sections.    return 2;}- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section{    int rows = 0;        if (section==0) {        rows = 0;    }    else if (section==1){        rows = [[ListOfData_2 objectForKey:@"Events"] count];    }    return rows;}-(CGFloat)getTextHeight{        return descriptionPlaceHolderSize;}- (CGFloat)tableView:(UITableView *)tableView heightForFooterInSection:(NSInteger)section{    if (section==0) {        return [self getTextHeight];    }    return 0;}- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {        static NSString *CellIdentifier = @"Cell";    CustomCell *cell = [tableView dequeueReusableCellWithIdentifier:CellIdentifier];    if (cell == nil) {        cell = [[CustomCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:CellIdentifier];    }        UIView *separatorLineView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 320, 10)];    separatorLineView.backgroundColor = [UIColor clearColor];    [cell.contentView addSubview:separatorLineView];        //================ Cell Padding ==============//    cell.backgroundColor = [UIColor clearColor];    cell.backgroundView = [UIView new] ;    cell.selectedBackgroundView = [UIView new];    [cell.cellLabel setFont:[UIFont fontWithName:@"Ubuntu-Medium" size:15]];    //============================================//        cell.cellLabel.text=[[[ListOfData_2 objectForKey:@"Events"]objectAtIndex:indexPath.row]objectForKey:@"name"];    cell.cellImageView.image=[UIImage imageNamed:@"event-icon.png"];        return cell;}- (BOOL)connectedToInternet{    InternetConnection *networkReachability = [InternetConnection reachabilityForInternetConnection];    NetworkStatus networkStatus = [networkReachability currentReachabilityStatus];        return networkStatus == NotReachable ?FALSE:TRUE;}-(void)loadJSON:(NSString *)url{        NSData* ytData = [NSData dataWithContentsOfURL:                      [NSURL URLWithString:url]                      ];        self.ListOfData_2 = [NSJSONSerialization                       JSONObjectWithData:ytData                       options:kNilOptions                       error:nil];    }- (void)scrollViewDidScroll:(UIScrollView *)scrollView{    int headerView = self.cTable.contentOffset.y;    v.buttomArrow.image=nil;        if (headerView==0) {        v.buttomArrow.image=[UIImage imageNamed:@"Down-arrow.png"];    }        int y=SCREEN_HEIGHT;    if (headerView >= 0 && headerView <= self.cTable.bounds.size.height ) {        alpha = headerView / (float) y;                alpha+=0.266999;                if (alpha > 1) {            alpha = 1;        }                BlurBackground.alpha=alpha;            }}-(void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath{        UIStoryboard *sb = [UIStoryboard storyboardWithName:@"Main" bundle:nil];    EventDetailsViewController *details = [sb instantiateViewControllerWithIdentifier:@"EventDetailsView"];      details.extraName=[[[ListOfData_2 objectForKey:@"Events"]objectAtIndex:indexPath.row]objectForKey:@"name"];    details.extraDate=[[[ListOfData_2 objectForKey:@"Events"]objectAtIndex:indexPath.row]objectForKey:@"date"];    details.extraTime=[[[ListOfData_2 objectForKey:@"Events"]objectAtIndex:indexPath.row]objectForKey:@"time"];    details.extraOrganizer=[[[ListOfData_2 objectForKey:@"Events"]objectAtIndex:indexPath.row]objectForKey:@"organizer"];    details.extraEntry=[[[ListOfData_2 objectForKey:@"Events"]objectAtIndex:indexPath.row]objectForKey:@"entry"];    details.extraLocation=[[[ListOfData_2 objectForKey:@"Events"]objectAtIndex:indexPath.row]objectForKey:@"Location"];    details.extraCity=[[[ListOfData_2 objectForKey:@"Events"]objectAtIndex:indexPath.row]objectForKey:@"city"];    details.extraDetails=[[[ListOfData_2 objectForKey:@"Events"]objectAtIndex:indexPath.row]objectForKey:@"details"];            [self.navigationController pushViewController:details animated:YES];        }- (void)didReceiveMemoryWarning{    [super didReceiveMemoryWarning];}@end